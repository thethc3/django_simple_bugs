{% extends 'base.html' %}
{% block content %}

    <div ng-view class="case"></div>

{% endblock %}
{% block js %}

    <script type="text/javascript">
	var caseApp = angular.module('caseApp', ['ngRoute', 'ngAnimate', 'ngSanitize', 'ngResource']);

	// configure our routes
    caseApp.config(function($routeProvider, $locationProvider) {
		$routeProvider.
			// route for the home page
			when('/', {
				templateUrl : '/socool/pages/list',
				controller  : 'PostsCtrlAjax'
			}).

			// route for the about page
			when('/detail/:caseId', {
				templateUrl : '/socool/pages/detail',
				controller  : 'CaseDetailResource'
			}).

            //route for new page
            when('/new', {
                templateUrl : '/socool/pages/new',
                controller : 'CaseNew'
            }).

            otherwise({redirectTo: '/'});

        //locationProvider.html5Mode(true);
	});

function CaseDetailResource($scope, $resource, $routeParams) {
    var Case = $resource('/api/cases/:caseId');
    Case.get({caseId: $routeParams.caseId}, function(data) {
        $scope.case_detail = data;
    });
}

function CaseDetail($scope, $routeParams, $http) {
    $http.get('/api/cases/' + $routeParams.caseId).success(function(data) {
        console.log(data)
        $scope.case_detail = data;
    });
}

function CaseNew($scope, $http, $location) {
    $scope.formData = {};
    $scope.formData.closed = false;
	$scope.save = function() {
		$http.post('/api/cases/', $scope.formData).success(function(data) {
		    $scope.formData = {}; // clear the form so our user is ready to enter another
			$scope.todos = data;
            $location.path('/detail/' + data.pk)
			console.log(data);
			}).error(function(data) {
				console.log('Error: ' + data);
                $scope.error = data
			});
};
}

function PostsCtrlAjax($scope, $http) {
    $scope.cases = [];
    $http({method: 'GET', url: '/api/cases/'}).success(function(data, status) {
        $scope.cases = data; // response data
        $scope.status = status;
});
}
</script>
{% endblock %}